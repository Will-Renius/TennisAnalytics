---
title: "Baseline Gambling Simulations"
author: "Nick Kurtansky"
date: "11/25/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The purpose of this is to provide the results to the two baseline strategies:
  1. Always betting the favorite
  2. Always betting the underdog
  
I will run this simulation seperately for each of the years from 2001 through 2017 in order to look for trends that may provide insight in how the oddsmakers have adapted over the years.

```{r include = FALSE}
library(ggplot2)
library(tidyr)
library(dplyr)
```

### load in data
```{r}
load('filtered.men.data.RData')
data <- data.filtered
```

### Clean Data
```{r}
# only include matches that sports books took bets on
data <- data %>% filter((countWinOdds > 0) & (countLoseOdds > 0))

# convert 'upset' to logical
data$upset <- as.logical(data$upset)

# upset by odds variable: odds.upset
data$odds.upset <- rep(NA, nrow(data))
for(i in 1:nrow(data)){
  data$odds.upset[i] <- ifelse(data$avgW[i] < data$avgL[i], FALSE, TRUE)
}
data$odds.upset <- as.logical(data$odds.upset)

# new column for absolute rank difference variable: abs.rank.dif
data <- data %>% mutate(abs.rank.dif = abs(WRank - LRank))

# new column for absolute odds difference variable: abs.odds.dif
data <- data %>% mutate(abs.odds.dif = abs(avgW - avgL))

# new column for odds of the favorite variable: fav.odds
data$fav.odds <- rep(NULL, nrow(data))
for(i in 1:nrow(data)){
  data$fav.odds[i] <- ifelse(as.numeric(data$odds.upset[i]) == 0, data$avgW[i], data$avgL[i])
}

# new column for variable: year
data$year <- rep(NA, nrow(data))
for(i in 1:nrow(data)){
  year <- substr(x = data$date[i], start = 1, stop = 4)
  data$year[i] <- year
}

#str(data)
```

### What is the raw probability of an upset?
```{r}
sum(data$odds.upset/nrow(data))
```

Upset occurs with probability 0.3283341... Hence, odds have a success rate p = 0.6716659


# Simulations

#### Outcome Matrix
Includes:
  Year, strategy, net profit, wins, tries
```{r}
Year <- c(2001:2017)
B1 <- rep("bet fav", times=17)
B2 <- rep("bet dog", times=17)
Net <- rep(NA, times=17)
Wins <- rep(NA, times=17)
Tries <- rep(NA, times=17)

df1 <- data.frame(Year, B1, Net, Wins, Tries)
df2 <- data.frame(Year, B2, Net, Wins, Tries)
```


## Baseline Strategy 1: always bet favorite

#### Function for single-year simulation
```{r}
bet.favorite <- function(df, wager = 10){
  # initialize
  net <- 0
  tries <- 0
  wins <- 0
  
  # for each match:
  for(i in 1:nrow(df)){
    
    # if chalk (win)
    if(df$avgW[i] < df$avgL[i]){
      bet.result <- wager * (df$avgW[i]-1)
      
      net <- net + bet.result
      wins <- wins + 1
      tries <- tries + 1
    }
    
    # if upset (loss)
    if(df$avgW[i] > df$avgL[i]){
      bet.result <- -1*wager
      
      net <- net + bet.result
      tries <- tries + 1
    }
  }
  
  # output a list
  out <- list(net, wins, tries)
  names(out) <- c("net","wins","tries")
  return(out)
}
```

#### Loop through all the seasons
```{r}
for(i in 1:length(Year)){
  season <- data %>% filter(year == Year[i])
  s.result <- bet.favorite(season, wager = 10)
  
  df1$Net[i] <- s.result[[1]]
  df1$Wins[i] <- s.result[[2]]
  df1$Tries[i] <- s.result[[3]]
}
names(df1)[2] <- "Strategy"
df1
```

NOTE OF CONCERN:
The year 2013 looks wrong. I know Will noticed some red-flags last week and made some adjustments, but I am still seeing issues here.

## Baseline Strategy 2: always bet underdog

#### Function for single-year simulation
```{r}
bet.underdog <- function(df, wager = 10){
  # initialize
  net <- 0
  tries <- 0
  wins <- 0
  
  # for each match:
  for(i in 1:nrow(df)){
    
    # if upset (win)
    if(df$avgW[i] > df$avgL[i]){
      bet.result <- wager * (df$avgW[i]-1)
      
      net <- net + bet.result
      wins <- wins + 1
      tries <- tries + 1
    }
    
    # if chalk (loss)
    if(df$avgW[i] < df$avgL[i]){
      bet.result <- -1*wager
      
      net <- net + bet.result
      tries <- tries + 1
    }
  }
  
  # output a list
  out <- list(net, wins, tries)
  names(out) <- c("net","wins","tries")
  return(out)
}
```

#### Loop through all the seasons
```{r}
for(i in 1:length(Year)){
  season <- data %>% filter(year == Year[i])
  s.result <- bet.underdog(season, wager = 10)
  
  df2$Net[i] <- s.result[[1]]
  df2$Wins[i] <- s.result[[2]]
  df2$Tries[i] <- s.result[[3]]
}
names(df2)[2] <- "Strategy"
df2
```

NOTE OF CONCERN: More issues with 2013; There is no chance we should be seeing $230,000 payout on $10 underdog bets. Also, I wonder about 2012. It is the only year we notice a profit... Hmm...

## View Results
```{r}
Result <- rbind(df1, df2)
names(Result) <- c("Year","Strategy","Net Profit (w/ $10 bets)","# Successes","# Tries")

Result
```

#### Comments on Results

I am concerned with the data we have for 2013. There surely is something wrong there with the filtered.men.data frame I used from the github. Another note of concern is the year 2012, where betting the underdog every time resulted in net profit. This leads to the ultimate conclusion from the baseline strategies: YOU CANNOT WIN WITH THEM... You will lose in the long run. However, betting the favorite is not quite as devastating as betting the underdog.